<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Sysui plugin</title>
    <url>/2020/01/20/sysui-plugin/</url>
    <content><![CDATA[<h1 id="ä¸€ã€SystemUI-pluginsæœºåˆ¶ä»‹ç»"><a href="#ä¸€ã€SystemUI-pluginsæœºåˆ¶ä»‹ç»" class="headerlink" title="ä¸€ã€SystemUI pluginsæœºåˆ¶ä»‹ç»"></a>ä¸€ã€SystemUI pluginsæœºåˆ¶ä»‹ç»</h1><p>æ’ä»¶æ˜¯åŒ…å«å¯ä»¥åŠ¨æ€åŠ è½½åˆ°SystemUIä¸­çš„ä»£ç å’Œèµ„æºçš„APKï¼Œæ’ä»¶æä¾›äº†ä¸€ç§å¿«é€Ÿåˆ›å»ºSystemUIåŠŸèƒ½çš„ç®€ä¾¿æ–¹æ³•ï¼Œé€šè¿‡åˆ›å»ºæ’ä»¶æ¥å®ç°SysUIä¸­å·²ç»å®šä¹‰çš„åŸºæœ¬æ¥å£é›†ï¼Œä»è€Œåœ¨è¿è¡Œæ—¶æ›´æ”¹SystemUIçš„è¡Œä¸ºï¼Œç”±æ¥å£æ§åˆ¶çš„ä»£ç å¯ä»¥æ›´å¿«çš„è¿­ä»£ã€‚</p>
<h1 id="äºŒã€åŸºæœ¬æ¶æ„"><a href="#äºŒã€åŸºæœ¬æ¶æ„" class="headerlink" title="äºŒã€åŸºæœ¬æ¶æ„"></a>äºŒã€åŸºæœ¬æ¶æ„</h1><p>ä¸‹å›¾æ˜¾ç¤ºäº†æ’ä»¶ç¼–è¯‘/åŠ è½½æµç¨‹çš„å·¥ä½œåŸç†<br><img src="/2020/01/20/sysui-plugin/sysui-plugins.png" alt="Sysui plugins è§£æ(ä»¥SampleOverlayPluginä¸ºä¾‹)"></p>
<h1 id="ä¸‰ã€ä»£ç ç»“æ„"><a href="#ä¸‰ã€ä»£ç ç»“æ„" class="headerlink" title="ä¸‰ã€ä»£ç ç»“æ„"></a>ä¸‰ã€ä»£ç ç»“æ„</h1><p>vendor\tran_os\packages\apps\SystemUI\plugin\ExamplePlugin\src\com\android\systemui\plugin\testoverlayplugin\ æ’ä»¶ç›®å½•ï¼Œç”Ÿæˆæ’ä»¶apkï¼Œsysuiæ¥å£å®ç°</p>
<p>vendor\tran_os\packages\apps\SystemUI\plugin\src\com\android\systemui\plugins\  åŠŸèƒ½æ¥å£å®šä¹‰</p>
<p>vendor\tran_os\packages\apps\SystemUI\plugin_core\  åŸºç¡€æ¥å£å®šä¹‰</p>
<p>vendor\tran_os\packages\apps\SystemUI\shared\src\com\android\systemui\shared\plugins\   pluginè¿è¡Œæ¨¡å—ï¼Œä¸»è¦è´Ÿè´£æ’ä»¶åŠ è½½ï¼Œç®¡ç†ç­‰</p>
<h1 id="å››ã€SampleOverlayPluginåŠ è½½æµç¨‹è§£æ"><a href="#å››ã€SampleOverlayPluginåŠ è½½æµç¨‹è§£æ" class="headerlink" title="å››ã€SampleOverlayPluginåŠ è½½æµç¨‹è§£æ"></a>å››ã€SampleOverlayPluginåŠ è½½æµç¨‹è§£æ</h1><h2 id="1ã€è§¦å‘åŠ è½½æ’ä»¶"><a href="#1ã€è§¦å‘åŠ è½½æ’ä»¶" class="headerlink" title="1ã€è§¦å‘åŠ è½½æ’ä»¶"></a>1ã€è§¦å‘åŠ è½½æ’ä»¶</h2><p>vendor\tran_os\packages\apps\SystemUI\src\com\android\systemui\SystemUIApplication.java<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Dependency.get(PluginManager.class).addPluginListener(</span><br><span class="line">                new PluginListener&lt;OverlayPlugin&gt;() &#123;</span><br><span class="line">                    private ArraySet&lt;OverlayPlugin&gt; mOverlays = new ArraySet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void onPluginConnected(OverlayPlugin plugin, Context pluginContext) &#123;</span><br><span class="line">                        mainHandler.post(new Runnable() &#123;</span><br><span class="line">                            @Override</span><br><span class="line">                            public void run() &#123;</span><br><span class="line">                                StatusBar statusBar = getComponent(StatusBar.class);</span><br><span class="line">                                if (statusBar != null) &#123;</span><br><span class="line">                                    plugin.setup(statusBar.getStatusBarWindow(),</span><br><span class="line">                                            statusBar.getNavigationBarView(), new Callback(plugin));</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void onPluginDisconnected(OverlayPlugin plugin) &#123;</span><br><span class="line">                        mainHandler.post(new Runnable() &#123;</span><br><span class="line">                            @Override</span><br><span class="line">                            public void run() &#123;</span><br><span class="line">                                mOverlays.remove(plugin);</span><br><span class="line">                                Dependency.get(StatusBarWindowController.class).setForcePluginOpen(</span><br><span class="line">                                        mOverlays.size() != 0);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    class Callback implements OverlayPlugin.Callback &#123;</span><br><span class="line">                        private final OverlayPlugin mPlugin;</span><br><span class="line"></span><br><span class="line">                        Callback(OverlayPlugin plugin) &#123;</span><br><span class="line">                            mPlugin = plugin;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        public void onHoldStatusBarOpenChange() &#123;</span><br><span class="line">                            if (mPlugin.holdStatusBarOpen()) &#123;</span><br><span class="line">                                mOverlays.add(mPlugin);</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                mOverlays.remove(mPlugin);</span><br><span class="line">                            &#125;</span><br><span class="line">                            mainHandler.post(new Runnable() &#123;</span><br><span class="line">                                @Override</span><br><span class="line">                                public void run() &#123;</span><br><span class="line">                                    Dependency.get(StatusBarWindowController.class)</span><br><span class="line">                                            .setStateListener(b -&gt; mOverlays.forEach(</span><br><span class="line">                                                    o -&gt; o.setCollapseDesired(b)));</span><br><span class="line">                                    Dependency.get(StatusBarWindowController.class)</span><br><span class="line">                                            .setForcePluginOpen(mOverlays.size() != 0);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, OverlayPlugin.class, true /* Allow multiple plugins */);</span><br></pre></td></tr></table></figure></p>
<p>Dependency.get(PluginManager.class)å¾—åˆ°çš„æ˜¯PluginManagerImplå¯¹è±¡ï¼Œè°ƒç”¨äº†void addPluginListener(PluginListener<t> listener, Class&lt;?&gt; cls,<br>boolean allowMultiple)æ–¹æ³•ï¼Œå®é™…è°ƒç”¨åˆ°addPluginListener(String action, PluginListener<t> listener,<br>Class cls, boolean allowMultiple)æ–¹æ³•</t></t></p>
<p>é€šè¿‡PluginManagerImplå°†å¯»æ‰¾OverlayPluginçš„å®ç°ï¼Œç»‘å®šååŒè¿‡OverlayPluginå®šä¹‰å¥½çš„æ¥å£å»è°ƒç”¨SampleOverlayPluginçš„å®ç°åŠŸèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹å¦‚ä½•å¯»æ‰¾åˆ°æ¥å£OverlayPluginçš„å®ç°</p>
<h2 id="2-addPluginListener"><a href="#2-addPluginListener" class="headerlink" title="2. addPluginListener"></a>2. addPluginListener</h2><p>vendor\tran_os\packages\apps\SystemUI\shared\src\com\android\systemui\shared\plugins\PluginManagerImpl.java<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public &lt;T extends Plugin&gt; void addPluginListener(String action, PluginListener&lt;T&gt; listener,</span><br><span class="line">        Class cls, boolean allowMultiple) &#123;</span><br><span class="line">    mPluginPrefs.addAction(action);</span><br><span class="line">    PluginInstanceManager p = mFactory.createPluginInstanceManager(mContext, action, listener,</span><br><span class="line">            allowMultiple, mLooper, cls, this);</span><br><span class="line">    p.loadAll();</span><br><span class="line">    mPluginMap.put(listener, p);</span><br><span class="line">    startListening();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­actionæ˜¯é€šè¿‡PluginManager.Helper.getAction(cls)è·å–çš„<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static &lt;P&gt; String getAction(Class&lt;P&gt; cls) &#123;</span><br><span class="line">    ProvidesInterface info = cls.getDeclaredAnnotation(ProvidesInterface.class);</span><br><span class="line">    if (info == null) &#123;</span><br><span class="line">        throw new RuntimeException(cls + &quot; doesn&apos;t provide an interface&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (TextUtils.isEmpty(info.action())) &#123;</span><br><span class="line">        throw new RuntimeException(cls + &quot; doesn&apos;t provide an action&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return info.action();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>getDeclaredAnnotationé€šè¿‡æ³¨è§£è·å–OverlayPluginçš„ACTION<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ProvidesInterface(action = OverlayPlugin.ACTION, version = OverlayPlugin.VERSION)</span><br><span class="line">public interface OverlayPlugin extends Plugin &#123;</span><br></pre></td></tr></table></figure></p>
<p>ä¸»è¦çœ‹ä¸€ä¸‹loadAllæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void loadAll() &#123;</span><br><span class="line">    if (DEBUG) Log.d(TAG, &quot;startListening&quot;);</span><br><span class="line">    mPluginHandler.sendEmptyMessage(PluginHandler.QUERY_ALL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void handleMessage(Message msg) &#123;</span><br><span class="line">        switch (msg.what) &#123;</span><br><span class="line">            case QUERY_ALL:</span><br><span class="line">                if (DEBUG) Log.d(TAG, &quot;queryAll &quot; + mAction);</span><br><span class="line">                for (int i = mPlugins.size() - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">                    PluginInfo&lt;T&gt; plugin = mPlugins.get(i);</span><br><span class="line">                    mListener.onPluginDisconnected(plugin.mPlugin);</span><br><span class="line">                    if (!(plugin.mPlugin instanceof PluginFragment)) &#123;</span><br><span class="line">                        // Only call onDestroy for plugins that aren&apos;t fragments, as fragments</span><br><span class="line">                        // will get the onDestroy as part of the fragment lifecycle.</span><br><span class="line">                        plugin.mPlugin.onDestroy();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                mPlugins.clear();</span><br><span class="line">                handleQueryPlugins(null);</span><br><span class="line">                break;</span><br><span class="line"></span><br><span class="line">private void handleQueryPlugins(String pkgName) &#123;</span><br><span class="line">        // This isn&apos;t actually a service and shouldn&apos;t ever be started, but is</span><br><span class="line">        // a convenient PM based way to manage our plugins.</span><br><span class="line">        Intent intent = new Intent(mAction);</span><br><span class="line">        if (pkgName != null) &#123;</span><br><span class="line">            intent.setPackage(pkgName);</span><br><span class="line">        &#125;</span><br><span class="line">        // pluginåœ¨AndroidManifestä¸­å¿…é¡»å£°æ˜ä¸º&lt;service&gt;ï¼ŒpackageManagerè¯»å–åˆ°æ‰€æœ‰çš„serviceä¿¡æ¯</span><br><span class="line">        List&lt;ResolveInfo&gt; result = mPm.queryIntentServices(intent, 0);</span><br><span class="line">        if (DEBUG) Log.d(TAG, &quot;Found &quot; + result.size() + &quot; plugins&quot;);</span><br><span class="line">        if (result.size() &gt; 1 &amp;&amp; !mAllowMultiple) &#123;</span><br><span class="line">            // TODO: Show warning.</span><br><span class="line">            Log.w(TAG, &quot;Multiple plugins found for &quot; + mAction);</span><br><span class="line">            if (DEBUG) &#123;</span><br><span class="line">                for (ResolveInfo info : result) &#123;</span><br><span class="line">                    ComponentName name = new ComponentName(info.serviceInfo.packageName,</span><br><span class="line">                            info.serviceInfo.name);</span><br><span class="line">                    Log.w(TAG, &quot;  &quot; + name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        for (ResolveInfo info : result) &#123;</span><br><span class="line">            ComponentName name = new ComponentName(info.serviceInfo.packageName,</span><br><span class="line">                    info.serviceInfo.name);</span><br><span class="line">            PluginInfo&lt;T&gt; t = handleLoadPlugin(name);</span><br><span class="line">            if (t == null) continue;</span><br><span class="line"></span><br><span class="line">            // add plugin before sending PLUGIN_CONNECTED message</span><br><span class="line">            mPlugins.add(t);</span><br><span class="line">            mMainHandler.obtainMessage(mMainHandler.PLUGIN_CONNECTED, t).sendToTarget();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected PluginInfo&lt;T&gt; handleLoadPlugin(ComponentName component) &#123;</span><br><span class="line">        // This was already checked, but do it again here to make extra extra sure, we don&apos;t</span><br><span class="line">        // use these on production builds.</span><br><span class="line">        if (!isDebuggable &amp;&amp; !isPluginWhitelisted(component)) &#123;</span><br><span class="line">            // Never ever ever allow these on production builds, they are only for prototyping.</span><br><span class="line">            Log.w(TAG, &quot;Plugin cannot be loaded on production build: &quot; + component);</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!mManager.getPluginEnabler().isEnabled(component)) &#123;</span><br><span class="line">            if (DEBUG) Log.d(TAG, &quot;Plugin is not enabled, aborting load: &quot; + component);</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        String pkg = component.getPackageName();</span><br><span class="line">        String cls = component.getClassName();</span><br><span class="line">        try &#123;</span><br><span class="line">            ApplicationInfo info = mPm.getApplicationInfo(pkg, 0);</span><br><span class="line">            // TODO: This probably isn&apos;t needed given that we don&apos;t have IGNORE_SECURITY on</span><br><span class="line">            // æ­¤å¤„æ£€æŸ¥è®¾ç½®çš„æƒé™</span><br><span class="line">            if (mPm.checkPermission(PLUGIN_PERMISSION, pkg)</span><br><span class="line">                    != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                Log.d(TAG, &quot;Plugin doesn&apos;t have permission: &quot; + pkg);</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            // Create our own ClassLoader so we can use our own code as the parent.</span><br><span class="line">            ClassLoader classLoader = mManager.getClassLoader(info);</span><br><span class="line">            Context pluginContext = new PluginContextWrapper(</span><br><span class="line">                    mContext.createApplicationContext(info, 0), classLoader);</span><br><span class="line">            Class&lt;?&gt; pluginClass = Class.forName(cls, true, classLoader);</span><br><span class="line">            // TODO: Only create the plugin before version check if we need it for</span><br><span class="line">            // legacy version check.</span><br><span class="line">            T plugin = (T) pluginClass.newInstance();</span><br><span class="line">            try &#123;</span><br><span class="line">                VersionInfo version = checkVersion(pluginClass, plugin, mVersion);</span><br><span class="line">                if (DEBUG) Log.d(TAG, &quot;createPlugin&quot;);</span><br><span class="line">                return new PluginInfo(pkg, cls, plugin, pluginContext, version);</span><br><span class="line">            &#125; catch (InvalidVersionException e) &#123;</span><br><span class="line">                final int icon = mContext.getResources().getIdentifier(&quot;tuner&quot;, &quot;drawable&quot;,</span><br><span class="line">                        mContext.getPackageName());</span><br><span class="line">                final int color = Resources.getSystem().getIdentifier(</span><br><span class="line">                        &quot;system_notification_accent_color&quot;, &quot;color&quot;, &quot;android&quot;);</span><br><span class="line">                final Notification.Builder nb = new Notification.Builder(mContext,</span><br><span class="line">                        PluginManager.NOTIFICATION_CHANNEL_ID)</span><br><span class="line">                                .setStyle(new Notification.BigTextStyle())</span><br><span class="line">                                .setSmallIcon(icon)</span><br><span class="line">                                .setWhen(0)</span><br><span class="line">                                .setShowWhen(false)</span><br><span class="line">                                .setVisibility(Notification.VISIBILITY_PUBLIC)</span><br><span class="line">                                .setColor(mContext.getColor(color));</span><br><span class="line">                String label = cls;</span><br><span class="line">                try &#123;</span><br><span class="line">                    label = mPm.getServiceInfo(component, 0).loadLabel(mPm).toString();</span><br><span class="line">                &#125; catch (NameNotFoundException e2) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                if (!e.isTooNew()) &#123;</span><br><span class="line">                    // Localization not required as this will never ever appear in a user build.</span><br><span class="line">                    nb.setContentTitle(&quot;Plugin \&quot;&quot; + label + &quot;\&quot; is too old&quot;)</span><br><span class="line">                            .setContentText(&quot;Contact plugin developer to get an updated&quot;</span><br><span class="line">                                    + &quot; version.\n&quot; + e.getMessage());</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // Localization not required as this will never ever appear in a user build.</span><br><span class="line">                    nb.setContentTitle(&quot;Plugin \&quot;&quot; + label + &quot;\&quot; is too new&quot;)</span><br><span class="line">                            .setContentText(&quot;Check to see if an OTA is available.\n&quot;</span><br><span class="line">                                    + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">                Intent i = new Intent(PluginManagerImpl.DISABLE_PLUGIN).setData(</span><br><span class="line">                        Uri.parse(&quot;package://&quot; + component.flattenToString()));</span><br><span class="line">                PendingIntent pi = PendingIntent.getBroadcast(mContext, 0, i, 0);</span><br><span class="line">                nb.addAction(new Action.Builder(null, &quot;Disable plugin&quot;, pi).build());</span><br><span class="line">                mContext.getSystemService(NotificationManager.class)</span><br><span class="line">                        .notifyAsUser(cls, SystemMessage.NOTE_PLUGIN, nb.build(),</span><br><span class="line">                                UserHandle.ALL);</span><br><span class="line">                // TODO: Warn user.</span><br><span class="line">                Log.w(TAG, &quot;Plugin has invalid interface version &quot; + plugin.getVersion()</span><br><span class="line">                        + &quot;, expected &quot; + mVersion);</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Throwable e) &#123;</span><br><span class="line">            Log.w(TAG, &quot;Couldn&apos;t load plugin: &quot; + pkg, e);</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   case PLUGIN_CONNECTED:</span><br><span class="line">      if (DEBUG) Log.d(TAG, &quot;onPluginConnected&quot;);</span><br><span class="line">      PluginPrefs.setHasPlugins(mContext);</span><br><span class="line">      PluginInfo&lt;T&gt; info = (PluginInfo&lt;T&gt;) msg.obj;</span><br><span class="line">      mManager.handleWtfs();</span><br><span class="line">      if (!(msg.obj instanceof PluginFragment)) &#123;</span><br><span class="line">       // Only call onDestroy for plugins that aren&apos;t fragments, as fragments</span><br><span class="line">       // will get the onCreate as part of the fragment lifecycle.</span><br><span class="line">       info.mPlugin.onCreate(mContext, info.mPluginContext);</span><br><span class="line">     &#125;</span><br><span class="line">     mListener.onPluginConnected(info.mPlugin, info.mPluginContext);</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹pluginçš„serviceå®šä¹‰ï¼Œå®šä¹‰çš„actionè¦ä¸æ¥å£OverlayPluginä¸­å®šä¹‰çš„ä¸€è‡´ï¼ŒPackageManageré€šè¿‡æ­¤actionæŸ¥è¯¢åˆ°plugin<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vendor\tran_os\packages\apps\SystemUI\plugin\ExamplePlugin\AndroidManifest.xml</span><br><span class="line">&lt;service android:name=&quot;.SampleOverlayPlugin&quot;</span><br><span class="line">         android:label=&quot;@string/plugin_label&quot;&gt;</span><br><span class="line">      &lt;intent-filter&gt;</span><br><span class="line">             &lt;action android:name=&quot;com.android.systemui.action.PLUGIN_OVERLAY&quot; /&gt;</span><br><span class="line">      &lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure></p>
<p>ä¹‹åé€šè¿‡PathClassLoaderåŠ è½½ç±»ï¼ŒPathClassLoaderåªèƒ½ç”¨äºåŠ è½½å·²å®‰è£…è¿‡çš„apkçš„dex<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ClassLoader getParentClassLoader() &#123;</span><br><span class="line">    if (mParentClassLoader == null) &#123;</span><br><span class="line">        // Lazily load this so it doesn&apos;t have any effect on devices without plugins.</span><br><span class="line">        mParentClassLoader = new ClassLoaderFilter(getClass().getClassLoader(),</span><br><span class="line">                &quot;com.android.systemui.plugin&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return mParentClassLoader;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Returns class loader specific for the given plugin. */</span><br><span class="line">public ClassLoader getClassLoader(ApplicationInfo appInfo) &#123;</span><br><span class="line">    if (!isDebuggable &amp;&amp; !isPluginPackageWhitelisted(appInfo.packageName)) &#123;</span><br><span class="line">        Log.w(TAG, &quot;Cannot get class loader for non-whitelisted plugin. Src:&quot;</span><br><span class="line">                + appInfo.sourceDir + &quot;, pkg: &quot; + appInfo.packageName);</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    if (mClassLoaders.containsKey(appInfo.packageName)) &#123;</span><br><span class="line">        return mClassLoaders.get(appInfo.packageName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; zipPaths = new ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; libPaths = new ArrayList&lt;&gt;();</span><br><span class="line">    LoadedApk.makePaths(null, true, appInfo, zipPaths, libPaths);</span><br><span class="line">    ClassLoader classLoader = new PathClassLoader(</span><br><span class="line">            TextUtils.join(File.pathSeparator, zipPaths),</span><br><span class="line">            TextUtils.join(File.pathSeparator, libPaths),</span><br><span class="line">            getParentClassLoader());</span><br><span class="line">    mClassLoaders.put(appInfo.packageName, classLoader);</span><br><span class="line">    return classLoader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤é€šè¿‡classLoaderåŠ è½½pluginç±»èµ‹å€¼åˆ°PluginInfo,ç„¶åå‘é€PLUGIN_CONNECTEDæ¶ˆæ¯ï¼Œè°ƒç”¨åˆ°mListener.onPluginConnectedï¼Œå›åˆ°ç¬¬ä¸€æ­¥addPluginListener-ã€‹PluginListenerï¼Œè°ƒç”¨plugin.setupï¼Œæ­¤pluginå·²ç»æ˜¯SampleOverlayPlugin apkä¸­çš„å®ç°ï¼Œä»è€Œå®Œæˆå¸ƒå±€åŠ è½½</p>
<h1 id="äº”ã€ç±»å›¾ç»“æ„"><a href="#äº”ã€ç±»å›¾ç»“æ„" class="headerlink" title="äº”ã€ç±»å›¾ç»“æ„"></a>äº”ã€ç±»å›¾ç»“æ„</h1><p><img src="/2020/01/20/sysui-plugin/class-structure.png" alt="Sysui plugins è§£æ(ä»¥SampleOverlayPluginä¸ºä¾‹)"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>SystemUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin Chapter Two</title>
    <url>/2020/01/19/kotlin-chapter-two/</url>
    <content><![CDATA[<h1 id="ç±»å’Œå¯¹è±¡"><a href="#ç±»å’Œå¯¹è±¡" class="headerlink" title="ç±»å’Œå¯¹è±¡"></a>ç±»å’Œå¯¹è±¡</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class MainActivity : AppCompatActivity() &#123;</span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆæ˜¯ç±»çš„å¯è§æ€§ï¼ŒJava ä¸­çš„ public åœ¨ Kotlin ä¸­å¯ä»¥çœç•¥ï¼ŒKotlin çš„ç±»é»˜è®¤æ˜¯ public çš„ã€‚</li>
<li>ç±»çš„ç»§æ‰¿çš„å†™æ³•ï¼ŒJava é‡Œç”¨çš„æ˜¯ extendsï¼Œè€Œåœ¨ Kotlin é‡Œä½¿ç”¨ :ï¼Œä½†å…¶å® : ä¸ä»…å¯ä»¥è¡¨ç¤ºç»§æ‰¿ï¼Œè¿˜å¯ä»¥è¡¨ç¤º Java ä¸­çš„ implement<a id="more"></a>
Kotlin é‡Œæˆ‘ä»¬æ³¨æ„åˆ° AppCompatActivity åé¢çš„ ()ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§çœç•¥çš„å†™æ³•ï¼Œç­‰ä»·äºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class MainActivity constructor() : AppCompatActivity() &#123;</span><br><span class="line">&#125;</span><br><span class="line">æˆ–è€…</span><br><span class="line">// æ³¨æ„è¿™é‡Œ AppCompatActivity åé¢æ²¡æœ‰ &apos;()&apos;</span><br><span class="line">class MainActivity : AppCompatActivity &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Kotlin æŠŠæ„é€ å‡½æ•°å•ç‹¬ç”¨äº†ä¸€ä¸ª constructor å…³é”®å­—æ¥å’Œå…¶ä»–çš„ fun åšåŒºåˆ†ã€‚</p>
<p>override çš„ä¸åŒ</p>
<ul>
<li>Java é‡Œé¢ @Override æ˜¯æ³¨è§£çš„å½¢å¼ã€‚</li>
<li>Kotlin é‡Œçš„ override å˜æˆäº†å…³é”®å­—ã€‚</li>
<li>Kotlin çœç•¥äº† protected å…³é”®å­—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒKotlin é‡Œçš„ override å‡½æ•°çš„å¯è§æ€§æ˜¯ç»§æ‰¿è‡ªçˆ¶ç±»çš„ã€‚</li>
</ul>
<p>é™¤äº†ä»¥ä¸Šè¿™äº›æ˜æ˜¾çš„ä¸åŒä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸åŒç‚¹ä»ä¸Šé¢çš„ä»£ç é‡Œçœ‹ä¸å‡ºæ¥ï¼Œä½†å½“ä½ å†™ä¸€ä¸ªç±»å»ç»§æ‰¿ MainActivity æ—¶å°±ä¼šå‘ç°ï¼š<br>Kotlin é‡Œçš„ MainActivity æ— æ³•ç»§æ‰¿ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å†™æ³•ä¼šæŠ¥é”™ï¼ŒThis type is final, so it cannot be inherited from</span><br><span class="line">class NewActivity: MainActivity() &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åŸå› æ˜¯ Kotlin é‡Œçš„ç±»é»˜è®¤æ˜¯ final çš„ï¼Œè€Œ Java é‡Œåªæœ‰åŠ äº† final å…³é”®å­—çš„ç±»æ‰æ˜¯ final çš„ã€‚<br>é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•è§£é™¤ final é™åˆ¶ä¹ˆï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ open æ¥åšè¿™ä»¶äº‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">open class MainActivity : AppCompatActivity() &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§æ‰¿äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class NewActivity: MainActivity() &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œæ­¤æ—¶ NewActivity ä»ç„¶æ˜¯ final çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œopen æ²¡æœ‰çˆ¶ç±»åˆ°å­ç±»çš„é—ä¼ æ€§ã€‚<br>è€Œåˆšæ‰è¯´åˆ°çš„ override æ˜¯æœ‰é—ä¼ æ€§çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class NewActivity : MainActivity() &#123;</span><br><span class="line">    // onCreate ä»ç„¶æ˜¯ override çš„</span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦å…³é—­ override çš„é—ä¼ æ€§ï¼Œåªéœ€è¦è¿™æ ·å³å¯ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">open class MainActivity : AppCompatActivity() &#123;</span><br><span class="line">    // åŠ  final å…³é”®å­—ï¼Œä½œç”¨å’Œ Java é‡Œé¢ä¸€æ ·ï¼Œå…³é—­äº† override çš„é—ä¼ æ€§</span><br><span class="line">    final override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬"><a href="#ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬" class="headerlink" title="ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬"></a>ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    if (activity is NewActivity) &#123;</span><br><span class="line">        // å¼ºè½¬ç”±äºç±»å‹æ¨æ–­è¢«çœç•¥äº†</span><br><span class="line">        activity.action()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨aså…³é”®å­—æ¥å¼ºè½¬</span><br><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    (activity as NewActivity).action()</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨as?æ¥é¿å…ç©ºå¯¹è±¡ï¼Œé¿å…æŠ¥é”™</span><br><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    // (activity as? NewActivity)&apos; ä¹‹åæ˜¯ä¸€ä¸ªå¯ç©ºç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ &apos;?.&apos; æ¥è°ƒç”¨</span><br><span class="line">    (activity as? NewActivity)?.action()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo notes</title>
    <url>/2020/01/18/hexo-notes/</url>
    <content><![CDATA[<p>Hexoå¸¸ç”¨å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init [folder]  //æ–°å»ºä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® folder ï¼ŒHexo é»˜è®¤åœ¨ç›®å‰çš„æ–‡ä»¶å¤¹å»ºç«‹ç½‘ç«™ã€‚</span><br><span class="line">hexo server         //å¯åŠ¨æœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š http://localhost:4000/ã€‚</span><br><span class="line">hexo g              //ç”Ÿæˆhtmlæ–‡ä»¶</span><br><span class="line">hexo clean          //æ¸…ç©ºç”Ÿæˆæ–‡ä»¶</span><br><span class="line">hexo new [layout] &lt;title&gt;  //æ–°å»ºä¸€ç¯‡æ–‡ç« ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® layout çš„è¯ï¼Œé»˜è®¤ä½¿ç”¨ _config.yml ä¸­çš„ default_layout å‚æ•°ä»£æ›¿ã€‚</span><br><span class="line">                           //å¦‚æœæ ‡é¢˜åŒ…å«ç©ºæ ¼çš„è¯ï¼Œè¯·ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚</span><br><span class="line">hexo new &quot;post title with whitespace&quot;</span><br><span class="line">hexo d            //éƒ¨ç½²ä¹‹å‰é¢„å…ˆç”Ÿæˆé™æ€æ–‡ä»¶</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin Get Started</title>
    <url>/2020/01/18/kotlin-get-started/</url>
    <content><![CDATA[<p>Kotlinå­¦ä¹ ç¬”è®°</p>
<h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><h2 id="å˜é‡çš„å£°æ˜ä¸èµ‹å€¼"><a href="#å˜é‡çš„å£°æ˜ä¸èµ‹å€¼" class="headerlink" title="å˜é‡çš„å£°æ˜ä¸èµ‹å€¼"></a>å˜é‡çš„å£°æ˜ä¸èµ‹å€¼</h2><p>æˆ‘ä»¬å›å¿†ä¸‹ Java é‡Œå£°æ˜ä¸€ä¸ª View ç±»å‹çš„å˜é‡çš„å†™æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">View v;</span><br></pre></td></tr></table></figure></p>
<p>kotlin é‡Œå£°æ˜ä¸€ä¸ªå˜é‡çš„æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var v: View</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰å‡ å¤„ä¸åŒï¼š</p>
<ul>
<li>æœ‰ä¸€ä¸ª var å…³é”®å­—</li>
<li>ç±»å‹å’Œå˜é‡åä½ç½®äº’æ¢äº†</li>
<li>ä¸­é—´æ˜¯ç”¨å†’å·åˆ†éš”çš„</li>
<li>ç»“å°¾æ²¡æœ‰åˆ†å·ï¼ˆå¯¹ï¼ŒKotlin é‡Œé¢ä¸éœ€è¦åˆ†å·ï¼‰<a id="more"></a>
<h2 id="Kotlin-çš„ç©ºå®‰å…¨è®¾è®¡"><a href="#Kotlin-çš„ç©ºå®‰å…¨è®¾è®¡" class="headerlink" title="Kotlin çš„ç©ºå®‰å…¨è®¾è®¡"></a>Kotlin çš„ç©ºå®‰å…¨è®¾è®¡</h2></li>
</ul>
<p>ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ IDE çš„æç¤ºæ¥é¿å…è°ƒç”¨ null å¯¹è±¡ï¼Œä»è€Œé¿å… NullPointerExceptionã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var view: View = null</span><br><span class="line">// IDE ä¼šæç¤ºé”™è¯¯ï¼ŒNull can not be a value of a non-null type View</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ï¼Ÿæ¥è¡¨ç¤ºå¯ç©ºï¼Œè¿™ç§ç±»å‹ä¹‹ååŠ  ? çš„å†™æ³•ï¼Œåœ¨ Kotlin é‡Œå«å¯ç©ºç±»å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">    var name: String? = null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">view?.setBackgroundColor(Color.RED)  //ä½¿ç”¨ï¼Ÿæ¥é¿å…NullPointerExceptionï¼Œå¦‚æœviewä¸ºç©ºå³ä¸ä¼šæ‰§è¡ŒsetBackgroundColor</span><br><span class="line">view!!.setBackgroundColor(Color.RED) //ä½¿ç”¨ï¼ï¼æ¥åšéç©ºæ–­è¨€ï¼Œå³å¼€å‘è€…ç¡®ä¿viewä¸ä¸ºç©ºï¼Œç¼–è¯‘å™¨ä¸éœ€è¦æ£€æŸ¥ï¼Œå¦‚æœå‡ºç°ç©ºçš„æƒ…å†µï¼Œè¿è¡Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</span><br></pre></td></tr></table></figure></p>
<h2 id="å»¶è¿Ÿåˆå§‹åŒ–"><a href="#å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="å»¶è¿Ÿåˆå§‹åŒ–"></a>å»¶è¿Ÿåˆå§‹åŒ–</h2><p>åœ¨å¼€å§‹æ— æ³•åˆå§‹åŒ–çš„å¯¹è±¡ï¼ŒKotlinæä¾›äº†å»¶è¿Ÿåˆå§‹åŒ–å…³é”®å­—lateinit<br>è¿™ä¸ª lateinit çš„æ„æ€æ˜¯ï¼šå‘Šè¯‰ç¼–è¯‘å™¨æˆ‘æ²¡æ³•ç¬¬ä¸€æ—¶é—´å°±åˆå§‹åŒ–ï¼Œä½†æˆ‘è‚¯å®šä¼šåœ¨ä½¿ç”¨å®ƒä¹‹å‰å®Œæˆåˆå§‹åŒ–çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lateinit var view: View</span><br><span class="line">override fun onCreate(...) &#123;</span><br><span class="line">    ...</span><br><span class="line">    view = findViewById(R.id.tvContent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ç±»å‹æ¨æ–­"><a href="#ç±»å‹æ¨æ–­" class="headerlink" title="ç±»å‹æ¨æ–­"></a>ç±»å‹æ¨æ–­</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var name: String = &quot;Mike&quot;</span><br><span class="line">var name = &quot;Mike&quot;</span><br></pre></td></tr></table></figure>
<h2 id="val-å’Œ-var"><a href="#val-å’Œ-var" class="headerlink" title="val å’Œ var"></a>val å’Œ var</h2><p>val å’Œ Java ä¸­çš„ final ç±»ä¼¼ï¼Œç§°ä¸ºåªè¯»å˜é‡ã€‚å®ƒåªèƒ½èµ‹å€¼ä¸€æ¬¡ï¼Œä¸èƒ½ä¿®æ”¹ã€‚è€Œ var æ˜¯ä¸€ç§å¯è¯»å¯å†™å˜é‡ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">val size = 18</span><br></pre></td></tr></table></figure></p>
<h2 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h2><p>åœ¨ Kotlin é‡Œå˜é‡é»˜è®¤æ˜¯ public çš„ï¼Œå…¶ä»–ä¸Javaç±»ä¼¼</p>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><p>Kotlin é™¤äº†å˜é‡å£°æ˜å¤–ï¼Œå‡½æ•°çš„å£°æ˜æ–¹å¼ä¹Ÿå’Œ Java çš„æ–¹æ³•ä¸ä¸€æ ·ã€‚Java çš„æ–¹æ³•ï¼ˆmethodï¼‰åœ¨ Kotlin é‡Œå«å‡½æ•°ï¼ˆfunctionï¼‰ï¼Œå…¶å®æ²¡å•¥åŒºåˆ«ï¼Œæˆ–è€…è¯´å…¶ä¸­çš„åŒºåˆ«æˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰ã€‚å¯¹ä»»ä½•ç¼–ç¨‹è¯­è¨€æ¥è®²ï¼Œå˜é‡å°±æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œå‡½æ•°å°±æ˜¯ç”¨æ¥å¤„ç†æ•°æ®ã€‚</p>
<h2 id="å‡½æ•°çš„å£°æ˜"><a href="#å‡½æ•°çš„å£°æ˜" class="headerlink" title="å‡½æ•°çš„å£°æ˜"></a>å‡½æ•°çš„å£°æ˜</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun cook(name: String): Food &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä»¥ fun å…³é”®å­—å¼€å¤´</li>
<li>è¿”å›å€¼å†™åœ¨äº†å‡½æ•°å’Œå‚æ•°åé¢ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œå†™ä½œUnitï¼Œå¹¶ä¸”å¯ä»¥çœç•¥</li>
</ul>
<h2 id="å¯è§æ€§-1"><a href="#å¯è§æ€§-1" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h2><p>å‡½æ•°å¦‚æœä¸åŠ å¯è§æ€§ä¿®é¥°ç¬¦çš„è¯ï¼Œé»˜è®¤çš„å¯è§èŒƒå›´å’Œå˜é‡ä¸€æ ·ä¹Ÿæ˜¯ public çš„</p>
<h2 id="å±æ€§çš„-getter-setter-å‡½æ•°"><a href="#å±æ€§çš„-getter-setter-å‡½æ•°" class="headerlink" title="å±æ€§çš„ getter/setter å‡½æ•°"></a>å±æ€§çš„ getter/setter å‡½æ•°</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Java é‡Œé¢çš„ field ç»å¸¸ä¼šå¸¦æœ‰ getter/setter å‡½æ•°<br>åœ¨ Kotlin é‡Œï¼Œè¿™ç§ getter / setter æ˜¯æ€ä¹ˆè¿ä½œçš„å‘¢ï¼Ÿ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">    var name = &quot;Mike&quot;</span><br><span class="line">        get() &#123;</span><br><span class="line">            return field + &quot; nb&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        set(value) &#123;</span><br><span class="line">            field = &quot;Cute &quot; + value</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h1><h2 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h2><p>åœ¨ Kotlin ä¸­ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ï¼ŒKotlin ä¸­ä½¿ç”¨çš„åŸºæœ¬ç±»å‹æœ‰ï¼šæ•°å­—ã€å­—ç¬¦ã€å¸ƒå°”å€¼ã€æ•°ç»„ä¸å­—ç¬¦ä¸²ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var number: Int = 1 // ğŸ‘ˆè¿˜æœ‰ Double Float Long Short Byte éƒ½ç±»ä¼¼</span><br><span class="line">var c: Char = &apos;c&apos;</span><br><span class="line">var b: Boolean = true</span><br><span class="line">var array: IntArray = intArrayOf(1, 2) // ğŸ‘ˆç±»ä¼¼çš„è¿˜æœ‰ FloatArray DoubleArray CharArray ç­‰ï¼ŒintArrayOf æ˜¯ Kotlin çš„ built-in å‡½æ•°</span><br><span class="line">var str: String = &quot;string&quot;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªåœ°æ–¹å’Œ Java ä¸å¤ªä¸€æ ·ï¼š<br>Kotlin é‡Œçš„ Int å’Œ Java é‡Œçš„ int ä»¥åŠ Integer ä¸åŒï¼Œä¸»è¦æ˜¯åœ¨è£…ç®±æ–¹é¢ä¸åŒã€‚<br>Java é‡Œçš„ int æ˜¯ unbox çš„ï¼Œè€Œ Integer æ˜¯ box çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int a = 1;</span><br><span class="line">Integer b = 2; // ğŸ‘ˆä¼šè¢«è‡ªåŠ¨è£…ç®± autoboxing</span><br><span class="line">Kotlin é‡Œï¼ŒInt æ˜¯å¦è£…ç®±æ ¹æ®åœºåˆæ¥å®šï¼š</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var a: Int = 1 // unbox</span><br><span class="line">var b: Int? = 2 // box</span><br><span class="line">var list: List&lt;Int&gt; = listOf(1, 2) // box</span><br></pre></td></tr></table></figure>
<p>Kotlin åœ¨è¯­è¨€å±‚é¢ç®€åŒ–äº† Java ä¸­çš„ int å’Œ Integerï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹æ˜¯å¦è£…ç®±çš„åœºæ™¯è¿˜æ˜¯è¦æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå› ä¸ºè¿™ä¸ªç‰µæ¶‰åˆ°ç¨‹åºè¿è¡Œæ—¶çš„æ€§èƒ½å¼€é”€ã€‚<br>å› æ­¤åœ¨æ—¥å¸¸çš„ä½¿ç”¨ä¸­ï¼Œå¯¹äº Int è¿™æ ·çš„åŸºæœ¬ç±»å‹ï¼Œå°½é‡ç”¨ä¸å¯ç©ºå˜é‡ã€‚<br>Java ä¸­çš„æ•°ç»„å’Œ Kotlin ä¸­çš„æ•°ç»„çš„å†™æ³•ä¹Ÿæœ‰åŒºåˆ«ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int[] array = new int[] &#123;1, 2&#125;;</span><br></pre></td></tr></table></figure></p>
<p>è€Œåœ¨ Kotlin é‡Œï¼Œä¸Šé¢çš„å†™æ³•æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var array: IntArray = intArrayOf(1, 2)</span><br><span class="line">// ğŸ‘†è¿™ç§ä¹Ÿæ˜¯ unbox çš„</span><br></pre></td></tr></table></figure></p>
<p>ç®€å•æ¥è¯´ï¼ŒåŸå…ˆåœ¨ Java é‡Œçš„åŸºæœ¬ç±»å‹ï¼Œç±»æ¯”åˆ° Kotlin é‡Œé¢ï¼Œæ¡ä»¶æ»¡è¶³å¦‚ä¸‹ä¹‹ä¸€å°±ä¸è£…ç®±ï¼š</p>
<ul>
<li>ä¸å¯ç©ºç±»å‹ã€‚</li>
<li>ä½¿ç”¨ IntArrayã€FloatArray ç­‰ã€‚</li>
</ul>
<h2 id="ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬"><a href="#ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬" class="headerlink" title="ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬"></a>ç±»å‹çš„åˆ¤æ–­å’Œå¼ºè½¬</h2><p>Kotlin é‡ŒåŒæ ·æœ‰ç±»ä¼¼è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ is å…³é”®å­—è¿›è¡Œã€Œç±»å‹åˆ¤æ–­ã€ï¼Œå¹¶ä¸”å› ä¸ºç¼–è¯‘å™¨èƒ½å¤Ÿè¿›è¡Œç±»å‹æ¨æ–­ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬çœç•¥å¼ºè½¬çš„å†™æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    if (activity is NewActivity) &#123;</span><br><span class="line">        // ğŸ‘‡çš„å¼ºè½¬ç”±äºç±»å‹æ¨æ–­è¢«çœç•¥äº†</span><br><span class="line">        activity.action()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆèƒ½ä¸èƒ½ä¸è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œç›´æ¥è¿›è¡Œå¼ºè½¬è°ƒç”¨å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ as å…³é”®å­—ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    (activity as NewActivity).action()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ç§å†™æ³•å¦‚æœå¼ºè½¬ç±»å‹æ“ä½œæ˜¯æ­£ç¡®çš„å½“ç„¶æ²¡é—®é¢˜ï¼Œä½†å¦‚æœå¼ºè½¬æˆä¸€ä¸ªé”™è¯¯çš„ç±»å‹ï¼Œç¨‹åºå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚<br>æˆ‘ä»¬æ›´å¸Œæœ›èƒ½è¿›è¡Œå®‰å…¨çš„å¼ºè½¬ï¼Œå¯ä»¥æ›´ä¼˜é›…åœ°å¤„ç†å¼ºè½¬å‡ºé”™çš„æƒ…å†µã€‚<br>è¿™ä¸€ç‚¹ï¼ŒKotlin åœ¨è®¾è®¡ä¸Šè‡ªç„¶ä¹Ÿè€ƒè™‘åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ as? æ¥è§£å†³ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun main() &#123;</span><br><span class="line">    var activity: Activity = NewActivity()</span><br><span class="line">    // ğŸ‘‡&apos;(activity as? NewActivity)&apos; ä¹‹åæ˜¯ä¸€ä¸ªå¯ç©ºç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ &apos;?.&apos; æ¥è°ƒç”¨</span><br><span class="line">    (activity as? NewActivity)?.action()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ƒçš„æ„æ€å°±æ˜¯è¯´å¦‚æœå¼ºè½¬æˆåŠŸå°±æ‰§è¡Œä¹‹åçš„è°ƒç”¨ï¼Œå¦‚æœå¼ºè½¬ä¸æˆåŠŸå°±ä¸æ‰§è¡Œã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello Markdown</title>
    <url>/2018/03/04/hello-markdown/</url>
    <content><![CDATA[<p>Markdownå¸¸ç”¨æ ¼å¼è®°å½•ä¾¿äºæŸ¥é˜…</p>
<h1 id="1ã€æ ‡é¢˜"><a href="#1ã€æ ‡é¢˜" class="headerlink" title="1ã€æ ‡é¢˜"></a>1ã€æ ‡é¢˜</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸€çº§æ ‡é¢˜</span><br><span class="line">## äºŒçº§æ ‡é¢˜</span><br><span class="line">ä»¥æ­¤ç±»æ¨ï¼Œæ³¨æ„#ä¸æ–‡å­—é—´åŠ ç©ºæ ¼</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="ä¸€çº§æ ‡é¢˜"><a href="#ä¸€çº§æ ‡é¢˜" class="headerlink" title="ä¸€çº§æ ‡é¢˜"></a>ä¸€çº§æ ‡é¢˜</h1><h2 id="äºŒçº§æ ‡é¢˜"><a href="#äºŒçº§æ ‡é¢˜" class="headerlink" title="äºŒçº§æ ‡é¢˜"></a>äºŒçº§æ ‡é¢˜</h2><h1 id="2ã€æ–‡å­—è¯­æ³•"><a href="#2ã€æ–‡å­—è¯­æ³•" class="headerlink" title="2ã€æ–‡å­—è¯­æ³•"></a>2ã€æ–‡å­—è¯­æ³•</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*Italics* or _Italics_ </span><br><span class="line">**Bold** or __Bold__ </span><br><span class="line">***Bold Italics*** or ___Bold Italics___ </span><br><span class="line">~~Delete~~</span><br><span class="line">&lt;u&gt;Underline&lt;/u&gt;</span><br></pre></td></tr></table></figure>
<p><em>Italics</em> or <em>Italics</em><br><strong>Bold</strong> or <strong>Bold</strong><br><strong><em>Bold Italics</em></strong> or <strong><em>Bold Italics</em></strong><br><del>Delete</del><br><u>Underline</u></p>
<h1 id="3ã€åˆ—è¡¨"><a href="#3ã€åˆ—è¡¨" class="headerlink" title="3ã€åˆ—è¡¨"></a>3ã€åˆ—è¡¨</h1><h2 id="3-1-æœ‰åºåˆ—è¡¨"><a href="#3-1-æœ‰åºåˆ—è¡¨" class="headerlink" title="3.1 æœ‰åºåˆ—è¡¨"></a>3.1 æœ‰åºåˆ—è¡¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. Item-1</span><br><span class="line"> 1.1. Item-1-1</span><br><span class="line">    1.1.1. Item-1-1-1</span><br><span class="line">      1.1.1.1. Item-1-1-1-1</span><br><span class="line">  1.2. Item-1-2</span><br><span class="line">2. Item-2</span><br></pre></td></tr></table></figure>
<ol>
<li>Item-1<br>1.1. Item-1-1<br> 1.1.1. Item-1-1-1<br>   1.1.1.1. Item-1-1-1-1<br>1.2. Item-1-2</li>
<li>Item-2</li>
</ol>
<h2 id="3-2-æ— åºåˆ—è¡¨"><a href="#3-2-æ— åºåˆ—è¡¨" class="headerlink" title="3.2 æ— åºåˆ—è¡¨"></a>3.2 æ— åºåˆ—è¡¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- Item-1</span><br><span class="line">  - Item-1-1</span><br><span class="line">    + Item-1-1-1</span><br><span class="line">      * Item-1-1-1-1</span><br><span class="line">  * Item-1-2</span><br><span class="line">+ Item-2</span><br></pre></td></tr></table></figure>
<ul>
<li>Item-1<ul>
<li>Item-1-1<ul>
<li>Item-1-1-1<ul>
<li>Item-1-1-1-1</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Item-1-2</li>
</ul>
</li>
</ul>
<ul>
<li>Item-2</li>
</ul>
<h1 id="4ã€é“¾æ¥"><a href="#4ã€é“¾æ¥" class="headerlink" title="4ã€é“¾æ¥"></a>4ã€é“¾æ¥</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">This is [an example](http://example.com/ &quot;XUECCI - Be Professtional&quot;) inline link.</span><br><span class="line">[This link](http://example.net/) has no title attribute.</span><br></pre></td></tr></table></figure>
<p>This is <a href="https://xuecci.github.io/" title="XUECCI - Be Professtional" target="_blank" rel="noopener">an example</a> inline link.<br><a href="https://xuecci.github.io/" target="_blank" rel="noopener">This link</a> has no title attribute.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ref]: https://xuecci.github.io/ &quot;XUECCI - Be Professtional&quot;</span><br></pre></td></tr></table></figure>
<h1 id="5ã€å›¾æ ‡"><a href="#5ã€å›¾æ ‡" class="headerlink" title="5ã€å›¾æ ‡"></a>5ã€å›¾æ ‡</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">![Hexo Mark](hello-markdown/hexo.png &quot;Hexo Mark&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="/2018/03/04/hello-markdown/hexo.png" alt="Hexo Mark" title="Hexo Mark"></p>
<h1 id="6ã€ä»£ç å—"><a href="#6ã€ä»£ç å—" class="headerlink" title="6ã€ä»£ç å—"></a>6ã€ä»£ç å—</h1><p>```<br>Code Line 1<br>Code Line 2<br>Code Line 3<br>```<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Code Line 1</span><br><span class="line">Code Line 2</span><br><span class="line">Code Line 3</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
</search>
